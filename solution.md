{{ self.title() }}

## 100 points

比较显然的做法是缩点。最坏情况和最好情况的答案分别为强连通分量的个数和没有入度的强连通分量个数。

考虑如何快速求强连通分量。首先容易证明一条城市之间的广播链 $x_1 -> x_2 -> \dots -> x_k$，其覆盖的广播有效区域是连续的，即一个区间。因此一个强联通分量在数轴上的广播范围必然是连续的。将一个强联通分量写成一个四元组 $(a, b, c, d)$，表示该强连通分量的广播范围为 $[a, d]$，同时两端的城市坐标分别为 $b, c$。其中显然有 $a \leq b \leq c \leq d$。

进一步容易看出，对于任意两个四元组 I,J，要么有 $b_I < c_I < b_J < c_J$，要么有 $b_I < b_J < c_J < c_I$，否则 I,J 可合并。其中后者表明 I 主导 J (即 I 可广播 J，且所有 J 可广播到的城市均可被 I 广播到)，且更进一步，有 $b_I < a_J < d_J < c_I$。

接下来考虑已知 [-\infty, x_k] 范围内所有城市的强联通分量情况后，加入城市 $x_{k+1}, d_{k+1}$ 后的变化。

考虑被某个 I 主导的四元组 J，显然 J 无法广播到新城市，否则必然存在一条从 $c_J$ 到 $x_{k+1}$ 的广播链 -> $c_I \in [c_J, x_{k+1}]$ -> J 可广播到 I，矛盾。故所有被主导的四元组(强连通分量)在此之后不再变化/影响答案。

则剩下不被主导的所有四元组必然满足 b, c 递增且 $[b, c]$ 不相交。

进一步考虑这些不被主导的四元组中，有哪些是无用的(在 $x_{k+1}$ 后不再变化)。注意到对于两个四元组 I, J，若 $b_I < b_J$，且 J 可广播 I，则 I 无法广播到新城市，否则存在一条 $b_I$ 到 $x_{k+1}$ 的广播链 -> I 可广播到 J，矛盾。

故可以将四元组分成以下三类：

1. 被主导的。在发现其被主导时，应令最坏情况的答案+1。
2. 存在 J 可以广播到 I：发现时应令最坏情况的答案+1。
3. 只能向后广播的四元组：b, c 递增且 $[b, c]$ 不相交。

考虑 $x_{k+1}$ 加入后这些四元组如何变化。显然原处 1,2 类的四元组不变。对于第三类四元组，$x_{k+1}$ 可广播到的四元组必然是一个后缀 $(I_1, I_2, \dots, I_k)$。这个后缀前的四元组不受影响。

考虑 $I_k$ 如果可以广播到 $x_{k+1}$，则合并 $x_{k+1}$ 和 $I_k$ 成新的 $x'_{k+1}$，再考虑 $I_{k-1}$；如果 $I_k$ 无法广播到 $x_{k+1}$，由于后缀内部只能向后广播，因此 $I_k$ 此后无用，令最坏答案 +1 后再用 $x_{k+1}$ 观察 $I_{k-1}$。

最后显然没有入度的四元组均在第三类中。由于广播链覆盖连续的区间，一个四元组 J 没有入度当且仅当其前缀中 $ max\{d_I\} < a_J $，反之该四元组有入度，最坏答案+1。
